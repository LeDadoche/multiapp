<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Assistant personnel</title>

  <!-- üîí Bootstrap de th√®me AVANT toute CSS pour √©viter le flash -->
  <script>
  (function () {
    try {
      var saved = localStorage.getItem('theme');
      if (!saved) {
        saved = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        localStorage.setItem('theme', saved);
      }
      if (saved === 'dark') {
        // on met la classe sur <html> (et ce sera pris par le CSS)
        document.documentElement.classList.add('dark-mode');
      }
    } catch (e) {}
  })();
  </script>

  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- Dropbox JS SDK -->
  <script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<header class="site-header">
  <!-- En-t√™te principal de l'application multi‚Äëservices -->
  <div class="topbar">
    <h1>Assistant personnel</h1>

    <!-- Menu Profil / R√©glages -->
    <div class="profile-menu">
      <button class="profile-trigger" id="profile-trigger" aria-haspopup="true" aria-expanded="false" title="Profil & R√©glages">
        <i class="fa-solid fa-user-gear"></i>
      </button>

      <div class="profile-dropdown" id="profile-dropdown" role="menu" aria-label="R√©glages">
        <div class="menu-section">
          <div class="menu-title">Apparence</div>
          <div class="toggle-row" style="justify-content: space-between;">
            <span>Th√®me</span>
            <button
              id="theme-toggle"
              class="theme-toggle"
              aria-label="Basculer le th√®me sombre"
              aria-pressed="false"
              title="Basculer le th√®me sombre"
            >
              <span class="tt-track" aria-hidden="true"></span>
              <span class="tt-knob" aria-hidden="true">
                <!-- Ic√¥nes SVG pour un rendu net -->
                <svg class="tt-sun" viewBox="0 0 24 24" aria-hidden="true">
                  <circle cx="12" cy="12" r="4"></circle>
                  <g class="rays">
                    <line x1="12" y1="1"  x2="12" y2="4"></line>
                    <line x1="12" y1="20" x2="12" y2="23"></line>
                    <line x1="1"  y1="12" x2="4"  y2="12"></line>
                    <line x1="20" y1="12" x2="23" y2="12"></line>
                    <line x1="4.2" y1="4.2"  x2="6.4" y2="6.4"></line>
                    <line x1="17.6" y1="17.6" x2="19.8" y2="19.8"></line>
                    <line x1="17.6" y1="6.4"  x2="19.8" y2="4.2"></line>
                    <line x1="4.2" y1="19.8" x2="6.4" y2="17.6"></line>
                  </g>
                </svg>
                <svg class="tt-moon" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M21 13.5A9 9 0 1 1 10.5 3
                          a7 7 0 0 0 10.5 10.5Z"></path>
                </svg>
              </span>
            </button>
          </div>

        </div>

        <div class="menu-section">
          <div class="menu-title">Cloud & synchronisation</div>

          <!-- Dropbox -->
          <div class="service-row">
            <div class="service-head">
              <i class="fa-brands fa-dropbox"></i>
              <span>Dropbox</span>
              <span class="service-status" id="dropbox-status">‚Ä¶</span>
            </div>
            <div class="service-actions">
              <button id="dropbox-login" class="dropbox-btn">Se connecter</button>
              <button id="dropbox-logout" class="dropbox-btn" style="display:none;">Se d√©connecter</button>
            </div>
          </div>

          <!-- Google Drive -->
          <div class="service-row">
            <div class="service-head">
              <i class="fa-brands fa-google-drive"></i>
              <span>Google Drive</span>
              <span class="service-status" id="google-status">‚Ä¶</span>
            </div>
            <div class="service-actions">
              <button id="google-login">Se connecter</button>
              <button id="google-logout" style="display:none;">Se d√©connecter</button>
            </div>
          </div>

          <!-- Microsoft OneDrive -->
          <div class="service-row">
            <div class="service-head">
              <i class="fa-brands fa-microsoft"></i>
              <span>Microsoft OneDrive</span>
              <span class="service-status" id="ms-status">‚Ä¶</span>
            </div>
            <div class="service-actions">
              <button id="ms-login">Se connecter</button>
              <button id="ms-logout" style="display:none;">Se d√©connecter</button>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /.profile-menu -->
  </div><!-- /.topbar -->

  <!-- Navigation des modules de la multi‚Äëapplication -->
  <nav class="app-nav" aria-label="Navigation des modules">
    <button class="app-btn active" data-app="finance"><i class="fa-solid fa-coins"></i> Finance</button>
    <button class="app-btn" data-app="agenda"><i class="fa-solid fa-calendar"></i> Agenda</button>
    <button class="app-btn" data-app="courses"><i class="fa-solid fa-cart-shopping"></i> Courses</button>
    <button class="app-btn" data-app="gamelles"><i class="fa-solid fa-bone"></i> Gamelles</button>
    <button class="app-btn" data-app="taches"><i class="fa-solid fa-list-check"></i> T√¢ches</button>
    <button class="app-btn" data-app="sante"><i class="fa-solid fa-heart-pulse"></i> Sant√©</button>
  </nav>
</header>

  <main>
    <!-- Section Finances : le contenu existant est encapsul√© dans une section d√©di√©e -->
    <div id="app-finance" class="app-section" style="display:block;">
      <div class="main-container">
      <nav class="tabs">
        <button class="tab-btn active" data-tab="tab-transactions">Transactions</button>
        <button class="tab-btn" data-tab="tab-stats">Statistiques</button>
        <button class="tab-btn" data-tab="tab-history">Historique</button>
      </nav>
      <!-- Onglet Transactions -->
      <div id="tab-transactions" class="tab-content" style="display:block;">
        <section id="form-section">
          <h2>Nouvelle transaction</h2>
          <form id="transaction-form" autocomplete="off">
            <div class="form-row">
              <label for="type">Type :</label>
              <select id="type" required>
                <option value="expense">D√©pense</option>
                <option value="income">Revenu</option>
              </select>
            </div>

            <div class="form-row">
              <label for="date">Date :</label>
              <input type="text" id="date" class="date-input" placeholder="jj-mm-aaaa" required />
            </div>

            <div class="form-row">
              <label for="recurrence">R√©currence :</label>
              <select id="recurrence">
                <option value="none">Aucune</option>
                <option value="monthly">Mensuelle</option>
                <option value="yearly">Annuelle</option>
                <option value="installments">Paiement en X fois</option>
              </select>
            </div>

            <div class="form-row" id="installments-row" style="display:none;">
              <label for="installments">Nombre d'√©ch√©ances :</label>
              <input type="number" id="installments" min="2" max="24" />
            </div>

            <div class="form-row" id="apply-previous-row" style="display:none;">
              <label style="display:flex;align-items:center;gap:0.6em;font-weight:normal;min-width:0;">
                <input type="checkbox" id="apply-previous" />
                Appliquer aux mois ant√©rieurs (depuis janvier)
              </label>
            </div>

            <div class="form-row">
              <label for="category">Cat√©gorie :</label>
              <div id="category-picker" class="category-picker">
                <input type="hidden" id="category" name="category" required>
                <span id="selected-category" class="category-icon-preview" title="Cliquez pour choisir une cat√©gorie" data-placeholder="1"></span>
                <div id="category-dropdown" class="category-dropdown" style="display:none;">
                  <div class="icon-picker-tabs">
                    <button class="icon-tab active" data-tab="fa" title="Font Awesome"><i class="fa-solid fa-star"></i></button>
                    <button class="icon-tab" data-tab="mi" title="Material Icons"><span class="material-icons">star</span></button>
                    <button class="icon-tab" data-tab="bs" title="Bootstrap"><i class="bi bi-star"></i></button>
                  </div>
                  <div class="icon-picker-list" data-tab="fa"></div>
                  <div class="icon-picker-list" data-tab="mi" style="display:none"></div>
                  <div class="icon-picker-list" data-tab="bs" style="display:none"></div>
                </div>
              </div>
            </div>

            <div class="form-row">
              <label for="description">Description :</label>
              <input type="text" id="description" required />
            </div>

            <div class="form-row">
              <label for="amount">Montant (‚Ç¨) :</label>
              <input type="number" id="amount" step="0.01" required />
            </div>

            <div class="form-row">
              <button type="submit">Ajouter</button>
            </div>
          </form>

        </section>
        <section id="salary-section">
          <h2>Salaire et √©conomies</h2>
          <div class="form-row">
            <label for="salary">Salaire mensuel (‚Ç¨) :</label>
            <input type="number" id="salary" step="0.01" />
          </div>
          <div class="form-row">
            <label for="savings">√âpargne d√©sir√©e (‚Ç¨) :</label>
            <input type="number" id="savings" step="0.01" />
          </div>
          <div class="form-row">
            <button id="calculate-saving">Calculer le reste √† vivre</button>
          </div>
          <p id="saving-result"></p>
        </section>
        <section id="calendar-section">
          <h2>Calendrier</h2>
          <div class="calendar-layout">
            <div class="calendar-wrapper">
              <div class="calendar-nav sticky-nav">
                <!-- S√©lecteur annuel de mois -->
                <div id="month-picker" class="month-picker" style="display:none;"></div>
                <button id="prev-month" aria-label="Mois pr√©c√©dent"><i class="fa-solid fa-arrow-left"></i></button>
                <span id="current-month"></span>
                <button id="next-month" aria-label="Mois suivant"><i class="fa-solid fa-arrow-right"></i></button>
                <button id="go-today" aria-label="Revenir √† aujourd'hui" title="Revenir √† aujourd'hui"><i class="fa-solid fa-calendar-day"></i> Aujourd'hui</button>
              </div>
              <table id="calendar"></table>
              <div id="day-details"></div>
            </div>
            <!-- L√©gende calendrier -->
           <div class="calendar-side-col">
            <aside class="legend-container" id="legend-container">
              <div class="legend-title">L√©gende calendrier</div>
              <ul class="legend-list">
                <li class="legend-item">
                  <span class="legend-color" style="background:var(--color-weekend)" data-var="--color-weekend"></span>
                  <i class="fa-solid fa-rotate-left legend-reset" data-var="--color-weekend" title="Remettre par d√©faut"></i>
                  <span class="legend-label">Week-end</span>
                </li>
                <li class="legend-item">
                  <span class="legend-color" style="background:var(--color-holiday)" data-var="--color-holiday"></span>
                  <i class="fa-solid fa-rotate-left legend-reset" data-var="--color-holiday" title="Remettre par d√©faut"></i>
                  <span class="legend-label">Jour f√©ri√©</span>
                </li>
                <li class="legend-item">
                  <span class="legend-color" style="background:var(--color-today)" data-var="--color-today"></span>
                  <i class="fa-solid fa-rotate-left legend-reset" data-var="--color-today" title="Remettre par d√©faut"></i>
                  <span class="legend-label">Aujourd'hui</span>
                </li>
                <li class="legend-item">
                  <span class="legend-color" style="background:var(--color-primary)" data-var="--color-primary"></span>
                  <i class="fa-solid fa-rotate-left legend-reset" data-var="--color-primary" title="Remettre par d√©faut"></i>
                  <span class="legend-label">S√©lection/Navigation</span>
                </li>
              </ul>
            </aside>
          <!-- R√©capitulatif du mois -->
          <section class="month-summary" id="month-summary">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.6em;">
              <h3 style="margin: 0;">R√©capitulatif du mois</h3>
              <button id="month-sort-btn" title="Changer le tri" style="background:none;border:none;cursor:pointer;font-size:1.3em;color:#27524b;">
                <i id="month-sort-icon" class="fa-solid fa-calendar-day"></i>
              </button>
              <label style="font-size: 0.9em; color: #27524b; display: flex; align-items: center; gap: 0.4em;">
                <input type="checkbox" id="group-by-category" />
                Regrouper par cat√©gorie
              </label>
            </div>
            <ul id="month-tx-list"></ul>
          </section>
        </div>
      </div>
        </section>
      </div>
      <!-- Onglet Statistiques -->
      <div id="tab-stats" class="tab-content" style="display:none;">
        <section id="stats-section">
          <h2>Statistiques</h2>
          <div id="chart-container">
            <canvas id="pie-chart" width="300" height="300"></canvas>
          </div>
          <p id="stats-info"></p>
        </section>
      </div>

      <!-- Onglet Historique -->
      <div id="tab-history" class="tab-content" style="display:none;">
        <section id="transactions-section">
          <h2>Liste des transactions</h2>
          <ul id="transactions-list"></ul>
        </section>
        <section id="export-section">
          <h2>Exportation</h2>
          <button id="export-json">Exporter en JSON</button>
        </section>
      </div>
      </div><!-- fin main-container finances -->
    </div><!-- fin app-finance -->
    <!-- Sections placeholders pour les autres modules de la multi‚Äëapplication -->
    <div id="app-agenda" class="app-section" style="display:none;">
      <section class="placeholder-section">
        <h2>Agenda</h2>
        <p>Ce module sera bient√¥t disponible.</p>
      </section>
    </div>
    <div id="app-courses" class="app-section" style="display:none;">
      <section class="placeholder-section">
        <h2>Courses</h2>
        <p>Ce module sera bient√¥t disponible.</p>
      </section>
    </div>
    <div id="app-gamelles" class="app-section" style="display:none;">
      <section class="placeholder-section">
        <h2>Gamelles</h2>
        <p>Ce module sera bient√¥t disponible.</p>
      </section>
    </div>
    <div id="app-taches" class="app-section" style="display:none;">
      <section class="placeholder-section">
        <h2>T√¢ches perso / pro</h2>
        <p>Ce module sera bient√¥t disponible.</p>
      </section>
    </div>
    <div id="app-sante" class="app-section" style="display:none;">
      <section class="placeholder-section">
        <h2>Sant√©</h2>
        <p>Ce module sera bient√¥t disponible.</p>
      </section>
    </div>
  </main>
  <!-- Modale Ajout rapide (calendrier) -->
<div id="modal-add-transaction" class="modal-bg" style="display:none;">
  <div class="modal-content">
    <h3 style="margin-top:0; color:#27524b;">Nouvelle transaction rapide</h3>
      <form id="add-transaction-form" novalidate>
        <div class="form-row">
          <label for="add-description">Description :</label>
          <input type="text" id="add-description" required />
        </div>

        <div class="form-row">
          <label for="add-date">Date :</label>
          <input type="text" id="add-date" class="date-input" placeholder="jj-mm-aaaa" required />
        </div>

        <div class="form-row">
          <label for="add-amount">Montant (‚Ç¨) :</label>
          <input type="number" id="add-amount" step="0.01" required />
        </div>

        <div class="form-row">
          <label for="add-type">Type :</label>
          <select id="add-type" required>
            <option value="expense">D√©pense</option>
            <option value="income">Revenu</option>
          </select>
        </div>

        <div class="form-row">
          <label for="add-category">Cat√©gorie :</label>
          <div id="add-category-picker" class="category-picker">
            <input type="hidden" id="add-category" name="category" required>
            <span id="add-selected-category" class="category-icon-preview" title="Clique pour choisir" data-placeholder="1">
              <i class="fa-regular fa-circle-question"></i>
            </span>
            <div id="add-category-dropdown" class="category-dropdown" style="display:none;">
              <div class="icon-picker-tabs">
                <button class="icon-tab active" data-tab="fa" title="Font Awesome"><i class="fa-solid fa-star"></i></button>
                <button class="icon-tab" data-tab="mi" title="Material Icons"><span class="material-icons">star</span></button>
                <button class="icon-tab" data-tab="bs" title="Bootstrap"><i class="bi bi-star"></i></button>
              </div>
              <div class="icon-picker-list" data-tab="fa"></div>
              <div class="icon-picker-list" data-tab="mi" style="display:none;"></div>
              <div class="icon-picker-list" data-tab="bs" style="display:none;"></div>
            </div>
          </div>
        </div>

        <div style="margin-top:1.5em; display:flex; justify-content:flex-end; gap:1em;">
          <button type="submit" style="background:#27524b;color:#fff;padding:0.5em 1.2em;border:none;border-radius:4px;cursor:pointer;">Ajouter</button>
          <button type="button" id="add-cancel-btn" style="background:#d32f2f;color:#fff;padding:0.5em 1.2em;border:none;border-radius:4px;cursor:pointer;">Annuler</button>
        </div>
      </form>
  </div>
</div>

  <!-- Modale Edition Historique -->
  <div id="modal-edit-transaction" class="modal-bg" style="display:none;">
    <div class="modal-content">
      <h3>Modifier la transaction</h3>
      <form id="edit-transaction-form" novalidate>
        <input type="hidden" id="edit-id" />
        <label>Description : <input type="text" id="edit-description" required /></label>
        <label>Montant (‚Ç¨) : <input type="number" id="edit-amount" step="0.01" required /></label>
        <label>Date : <input type="text" id="edit-date" class="date-input" placeholder="jj-mm-aaaa" required /></label>
        <label>Type :
          <select id="edit-type" required>
            <option value="expense">D√©pense</option>
            <option value="income">Revenu</option>
          </select>
        </label>
        <label>R√©currence :
          <select id="edit-recurrence">
            <option value="none">Aucune</option>
            <option value="monthly">Mensuelle</option>
            <option value="installments">Paiement en X fois</option>
          </select>
        </label>
        <div class="form-row" id="edit-apply-previous-row" style="display:none;">
          <label style="display:flex;align-items:center;gap:0.6em;font-weight:normal;min-width:0;">
            <input type="checkbox" id="edit-apply-previous" />
            Appliquer aux mois ant√©rieurs
          </label>
        </div>
        <div style="margin-top:1em;display:flex;gap:1em;">
          <button type="submit">Enregistrer</button>
          <button type="button" id="edit-cancel-btn">Annuler</button>
        </div>
      </form>
    </div>
  </div>
<!-- Overlay d'authentification -->
<div id="auth-overlay" class="modal-bg" style="display:none;">
  <div class="modal-content">
    <h3 id="auth-title">Authentification</h3>
    <form id="auth-form" novalidate>
      <div class="form-row">
        <label for="auth-password">Mot de passe :</label>
        <input type="password" id="auth-password"
               autocomplete="current-password" required />
      </div>

      <div class="form-row" id="auth-confirm-row" style="display:none;">
        <label for="auth-password-confirm">Confirmer :</label>
        <!-- ATTENTION : PAS de required ici -->
        <input type="password" id="auth-password-confirm"
               autocomplete="new-password" />
      </div>

      <div style="text-align:right;">
        <button type="submit" id="auth-submit-btn">Valider</button>
      </div>
    </form>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
